<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸŒŽ World Festival Map</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
}
h1 {
  margin: 20px 0;
}
#controls {
  margin-bottom: 10px;
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
}
#controls input, #controls select, #controls button {
  margin: 5px;
  padding: 6px 10px;
  cursor: pointer;
}
#map {
  height: 80vh;
  width: 90vw;
  max-width: 1200px;
  border: 2px solid #333;
  border-radius: 10px;
}
</style>
</head>
<body>

<h1>ðŸŒŽ World Festival Map</h1>

<div id="controls">
  <input type="text" id="search" placeholder="Search festival or country">
  <select id="typeFilter">
    <option value="all">All Types</option>
    <option value="music">Music</option>
    <option value="food">Food</option>
    <option value="culture">Culture</option>
    <option value="tradition">Tradition</option>
  </select>
  <select id="monthFilter">
    <option value="all">All Months</option>
    <option value="1">January</option>
    <option value="2">February</option>
    <option value="3">March</option>
    <option value="4">April</option>
    <option value="5">May</option>
    <option value="6">June</option>
    <option value="7">July</option>
    <option value="8">August</option>
    <option value="9">September</option>
    <option value="10">October</option>
    <option value="11">November</option>
    <option value="12">December</option>
  </select>
  <button onclick="applyFilters()">Apply Filters</button>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// Initialize map
const map = L.map('map').setView([20, 0], 2);

// Add OpenStreetMap tiles
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 18 }).addTo(map);

// Sample festival data
const festivals = [
  { name: "Rio Carnival", country: "Brazil", type: "music", month: 2, lat: -22.9068, lon: -43.1729, description: "The biggest carnival in the world, full of samba and parades.", image: "https://upload.wikimedia.org/wikipedia/commons/9/97/Rio_Carnival_2014.jpg" },
  { name: "Oktoberfest", country: "Germany", type: "food", month: 10, lat: 48.1351, lon: 11.5820, description: "World-famous beer festival with traditional Bavarian food.", image: "https://upload.wikimedia.org/wikipedia/commons/6/66/Munich_Oktoberfest_2012.JPG" },
  { name: "Diwali", country: "India", type: "tradition", month: 11, lat: 28.6139, lon: 77.2090, description: "Festival of lights celebrated across India with lamps and fireworks.", image: "https://upload.wikimedia.org/wikipedia/commons/9/91/Diwali_lights.jpg" },
  { name: "Cherry Blossom Festival", country: "Japan", type: "culture", month: 4, lat: 35.6762, lon: 139.6503, description: "Spring festival celebrating cherry blossoms and Japanese culture.", image: "https://upload.wikimedia.org/wikipedia/commons/0/0e/Cherry_blossoms_at_Ueno_Park.jpg" }
];

// Store markers
let markers = [];

// Add markers to map
function addMarkers() {
  festivals.forEach(f => {
    const marker = L.circleMarker([f.lat, f.lon], { radius: 10, color: getColor(f.type), fillOpacity: 0.7 }).addTo(map);
    marker.bindPopup(`<h3>${f.name} (${f.country})</h3><img src="${f.image}" width="200"><p>${f.description}</p>`);
    marker.festivalType = f.type;
    marker.festivalMonth = f.month;
    marker.name = f.name.toLowerCase();
    marker.country = f.country.toLowerCase();
    markers.push(marker);
  });
}

// Color based on type
function getColor(type) {
  switch(type) {
    case 'music': return 'red';
    case 'food': return 'orange';
    case 'culture': return 'green';
    case 'tradition': return 'blue';
    default: return 'gray';
  }
}

// Filter function
function applyFilters() {
  const type = document.getElementById('typeFilter').value;
  const month = document.getElementById('monthFilter').value;
  const search = document.getElementById('search').value.toLowerCase();

  markers.forEach(marker => {
    const matchesType = type === 'all' || marker.festivalType === type;
    const matchesMonth = month === 'all' || marker.festivalMonth == month;
    const matchesSearch = search === '' || marker.name.includes(search) || marker.country.includes(search);

    if (matchesType && matchesMonth && matchesSearch) {
      marker.addTo(map);
    } else {
      map.removeLayer(marker);
    }
  });
}

// Handle shareable links
function loadFromURL() {
  const params = new URLSearchParams(window.location.search);
  const festivalName = params.get('festival');
  if(festivalName) {
    const marker = markers.find(m => m.name === festivalName.toLowerCase());
    if(marker) {
      map.setView(marker.getLatLng(), 5);
      marker.openPopup();
    }
  }
}

// Initialize
addMarkers();
loadFromURL();
</script>

</body>
</html>
