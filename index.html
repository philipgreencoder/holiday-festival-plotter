<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Holiday & Festival Plotter</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  body { margin:0; font-family:'Arial',sans-serif; background: linear-gradient(135deg,#1a1a1a 0%,#2c2c2c 100%); color:#fff; }
  .container { max-width:1200px; margin:auto; padding:20px; }
  h1 { text-align:center; color:#e74c3c; margin-bottom:10px; }
  .description-box { background:#222; padding:15px; border-radius:12px; margin-bottom:20px; text-align:center; color:#ccc; }
  .search-container { display:flex; justify-content:center; margin-bottom:15px; position:relative; }
  #festival-input { width:100%; padding:12px; border-radius:12px; border:none; outline:none; font-size:16px; background-color:#333; color:#fff; }
  .suggestions { position:absolute; top:48px; width:100%; background:#222; border-radius:0 0 12px 12px; max-height:200px; overflow-y:auto; z-index:1000; }
  .suggestions div { padding:10px; cursor:pointer; }
  .suggestions div:hover { background:#e74c3c; }
  #map { height:500px; border-radius:12px; margin-bottom:20px; }
  .festival-card { display:flex; flex-direction:row; background-color:#333; padding:20px; border-radius:12px; margin-bottom:20px; box-shadow:0 0 20px rgba(231,76,60,0.5); opacity:0; transform:translateY(20px); transition: all 0.6s ease; }
  .festival-card.visible { opacity:1; transform:translateY(0); }
  .festival-info { flex:1; padding-right:15px; }
  .festival-info h2 { margin-top:0; color:#e74c3c; }
  .festival-info p { margin:5px 0; line-height:1.3em; }
  .festival-images { flex:1; display:flex; flex-direction:column; gap:10px; }
  .festival-images img { width:100%; border-radius:12px; }
  @media(max-width:900px){ .festival-card{flex-direction:column;} .festival-info{padding-right:0;} }
</style>
</head>
<body>
<div class="container">
<h1>Holiday & Festival Plotter</h1>
<div class="description-box">Type a festival or holiday. The map will fly to its country, and you'll see info and images on the side.</div>
<div class="search-container">
<input type="text" id="festival-input" placeholder="Search festivals/holidays...">
<div class="suggestions" id="suggestions"></div>
</div>
<div id="map"></div>
<div id="festival-info"></div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// ================= API KEYS =================
const CALENDARIFIC_API_KEY = "YOUR_CALENDARIFIC_KEY";
const ABSTRACT_API_KEY = "YOUR_ABSTRACT_KEY";

// ================= COUNTRY COORDINATES =================
const countryCoords = {
"US":[37.0902,-95.7129],"IN":[20.5937,78.9629],"RU":[61.5240,105.3188],
"CN":[35.8617,104.1954],"BR":[-14.2350,-51.9253],"MX":[23.6345,-102.5528],
"FR":[46.2276,2.2137],"DE":[51.1657,10.4515],"JP":[36.2048,138.2529],
"IT":[41.8719,12.5674],"ES":[40.4637,-3.7492],"CA":[56.1304,-106.3468],
"AU":[-25.2744,133.7751],"GB":[55.3781,-3.4360],"AR":[-38.4161,-63.6167],
"ZA":[-30.5595,22.9375],"EG":[26.8206,30.8025],"KR":[35.9078,127.7669],
"SE":[60.1282,18.6435],"NO":[60.4720,8.4689],"CH":[46.8182,8.2275],
"NL":[52.1326,5.2913],"BE":[50.5039,4.4699],"AT":[47.5162,14.5501],
"DK":[56.2639,9.5018],"FI":[61.9241,25.7482],"PL":[51.9194,19.1451],
"PT":[39.3999,-8.2245],"GR":[39.0742,21.8243],"TR":[38.9637,35.2433],
"IR":[32.4279,53.6880],"PK":[30.3753,69.3451],"BD":[23.6850,90.3563],
"ID":[-0.7893,113.9213],"TH":[15.8700,100.9925],"MY":[4.2105,101.9758],
"SG":[1.3521,103.8198],"PH":[12.8797,121.7740],"VN":[14.0583,108.2772],
"AE":[23.4241,53.8478],"SA":[23.8859,45.0792],"IL":[31.0461,34.8516],
"NG":[9.0820,8.6753],"KE":[-0.0236,37.9062],"TZ":[-6.3690,34.8888],
"CO":[4.5709,-74.2973],"CL":[-35.6751,-71.5430],"PE":[-9.189967,-75.015152],
"VE":[6.4238,-66.5897],"NZ":[-40.9006,174.8860],"IE":[53.4129,-8.2439],
"PT":[39.3999,-8.2245],"HU":[47.1625,19.5033],"CZ":[49.8175,15.4730],
"SK":[48.6690,19.6990],"RO":[45.9432,24.9668],"BG":[42.7339,25.4858],
"UA":[48.3794,31.1656],"BY":[53.7098,27.9534],"LT":[55.1694,23.8813],
"LV":[56.8796,24.6032],"EE":[58.5953,25.0136],"IS":[64.9631,-19.0208]
};

// ================= MAP INITIALIZATION =================
const map = L.map('map').setView([20,0],2);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  attribution:'&copy; OpenStreetMap contributors'
}).addTo(map);
let currentMarker = null;

// ================= AUTOCOMPLETE =================
let festivalNames = [];
const input=document.getElementById("festival-input");
const suggestionsContainer=document.getElementById("suggestions");
const festivalInfo=document.getElementById("festival-info");

input.addEventListener("input",function(){
  const value=this.value.toLowerCase();
  suggestionsContainer.innerHTML="";
  if(!value) return;
  const filtered=festivalNames.filter(name=>name.toLowerCase().startsWith(value));
  filtered.forEach(name=>{// ================= FETCH FESTIVAL/HOLIDAY DATA =================
async function fetchFestivalData(name){
  festivalInfo.innerHTML="<p>Loading...</p>";
  try{
    const year = new Date().getFullYear();
    let foundHoliday = null;
    let foundCountry = null;

    // Search across all countries
    for(const countryCode in countryCoords){
      const url = `https://calendarific.com/api/v2/holidays?api_key=${CALENDARIFIC_API_KEY}&country=${countryCode}&year=${year}`;
      const res = await fetch(url);
      const data = await res.json();
      if(data.response && data.response.holidays){
        const holiday = data.response.holidays.find(h => h.name.toLowerCase() === name.toLowerCase());
        if(holiday){ 
          foundHoliday = holiday; 
          foundCountry = countryCode; 
          break; 
        }
      }
    }

    if(!foundHoliday){
      festivalInfo.innerHTML="<p>Festival not found.</p>"; 
      return; 
    }

    // Add to autocomplete list dynamically if new
    if(!festivalNames.includes(foundHoliday.name)) festivalNames.push(foundHoliday.name);

    // ================= FETCH IMAGES FROM ABSTRACT API =================
    const abstractURL = `https://api.abstractapi.com/v1/images?api_key=${ABSTRACT_API_KEY}&query=${encodeURIComponent(name + " festival")}&limit=3`;
    const imgRes = await fetch(abstractURL);
    const imgData = await imgRes.json();
    const images = imgData.results || [];

    // ================= MAP FLY-TO AND MARKER =================
    const coords = countryCoords[foundCountry] || [20,0];
    map.flyTo(coords,5,{animate:true,duration:2});
    if(currentMarker) map.removeLayer(currentMarker);
    currentMarker = L.marker(coords).addTo(map).bindPopup(foundHoliday.name).openPopup();

    // ================= BUILD FESTIVAL CARD =================
    let imgHTML = "";
    images.forEach(img=>{
      if(img.url) imgHTML += `<img src="${img.url}" alt="${foundHoliday.name}">`;
    });

    // Short 3-line description
    let shortDesc = foundHoliday.description ? foundHoliday.description.split(" ").slice(0,40).join(" ") + "..." : "No description available.";

    festivalInfo.innerHTML=`
      <div class="festival-card">
        <div class="festival-info">
          <h2>${foundHoliday.name}</h2>
          <p>${shortDesc}</p>
          <p>Country: ${foundHoliday.country.name} | Date: ${foundHoliday.date.iso}</p>
        </div>
        <div class="festival-images">${imgHTML}</div>
      </div>
    `;

    // Trigger fade-in
    const card=document.querySelector(".festival-card");
    setTimeout(()=>{ card.classList.add("visible"); },50);

  }catch(err){
    console.error(err); 
    festivalInfo.innerHTML="<p>Error fetching data.</p>"; 
  }
}

// ================= POPULATE AUTOCOMPLETE WITH INITIAL DATA =================
async function populateAutocomplete(){
  const year = new Date().getFullYear();
  for(const countryCode in countryCoords){
    try{
      const url = `https://calendarific.com/api/v2/holidays?api_key=${CALENDARIFIC_API_KEY}&country=${countryCode}&year=${year}`;
      const res = await fetch(url);
      const data = await res.json();
      if(data.response && data.response.holidays){
        data.response.holidays.forEach(h => {
          if(!festivalNames.includes(h.name)) festivalNames.push(h.name);
        });
      }
    }catch(err){ console.error("Error fetching holidays for " + countryCode, err); }
  }
}

// Populate initial autocomplete list in background
populateAutocomplete();
</script>
</body>
</html>

    const div=document.createElement("div");
    div.textContent=name;
    div.addEventListener("click",()=>{input.value=name;suggestionsContainer.innerHTML="";fetchFestivalData(name);});
    suggestionsContainer.appendChild(div);
  });
});

