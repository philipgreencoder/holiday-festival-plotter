<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>World Festivals Explorer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f5f5f5;
      color: #222;
    }
    h1 { text-align: center; }
    #searchBox {
      width: 100%; padding: 12px; margin-bottom: 20px;
      border-radius: 8px; border: 1px solid #aaa;
    }
    #result {
      background: #fff; padding: 20px; border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .images img {
      width: 180px; height: auto; margin: 8px; border-radius: 8px;
    }
  </style>
</head>
<body>
  <h1>World Festivals Explorer</h1>
  <input id="searchBox" placeholder="Search any festival... (ex: Diwali)" />
  <div id="result">Type a festival name above.</div>

<script>
// ---------------- CONFIG ----------------
const CALENDARIFIC_API_KEY = "Ki0V2X3XAougOSlBbQLjPTZzesmn84g1";
const WIKIDATA_ENDPOINT = "https://query.wikidata.org/sparql";
const WIKIPEDIA_API = "https://en.wikipedia.org/api/rest_v1/page/summary/";
const COMMONS_API = "https://commons.wikimedia.org/w/api.php";

// ---------------- FUNCTIONS ----------------
async function getWikipediaSummary(name){
  try{
    let r = await fetch(WIKIPEDIA_API + encodeURIComponent(name));
    let d = await r.json();
    return d.extract || "No summary available.";
  } catch{
    return "No Wikipedia page found.";
  }
}

async function getCommonsImages(name){
  let url = `${COMMONS_API}?action=query&generator=search&gsrsearch=${encodeURIComponent(name)}&gsrlimit=8&prop=imageinfo&iiprop=url&format=json&origin=*`;
  let r = await fetch(url); let d = await r.json();
  let pages = d?.query?.pages || {};
  return Object.values(pages).map(p=>p.imageinfo?.[0]?.url).filter(Boolean);
}

async function getWikidataInfo(name){
  let query = `SELECT ?festival ?festivalLabel ?countryLabel ?image WHERE {
      ?festival wdt:P31 wd:Q132241.
      OPTIONAL { ?festival wdt:P495 ?country. }
      OPTIONAL { ?festival wdt:P18 ?image. }
      SERVICE wikibase:label { bd:serviceParam wikibase:language "en". }
  }`;

  let url = WIKIDATA_ENDPOINT + "?format=json&query=" + encodeURIComponent(query);
  let r = await fetch(url); let j = await r.json();
  let rows = j.results.bindings;

  return rows.find(f => f.festivalLabel.value.toLowerCase() === name.toLowerCase()) || null;
}

async function searchFestival(name){
  let summary = await getWikipediaSummary(name);
  let images = await getCommonsImages(name);
  let wikidata = await getWikidataInfo(name);

  document.getElementById("result").innerHTML = `
    <h2>${name}</h2>
    <p>${summary}</p>

    ${wikidata ? `<p><b>Country:</b> ${wikidata.countryLabel?.value || "Unknown"}</p>` : ""}

    <div class="images">
      ${(images.length ? images.map(i=>`<img src="${i}">`).join("") : "No images found.")}
    </div>
  `;
}

// ---------------- LISTENER ----------------
document.getElementById("searchBox").addEventListener("keydown", e=>{
  if(e.key === "Enter"){
    searchFestival(e.target.value.trim());
  }
});
</script>
</body>
</html>
